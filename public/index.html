<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Location Tracker</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <script type="text/javascript">
const firebaseConfig = {
    apiKey: "AIzaSyDOIw-fFTJw9vmXY0dYpMv1n-wVJ4q_Lag",
    authDomain: "e-alert-pro.firebaseapp.com",
    projectId: "e-alert-pro",
    storageBucket: "e-alert-pro.appspot.com",
    messagingSenderId: "1023817610592",
    appId: "1:1023817610592:web:356fd0cf61dce22be6da05",
    measurementId: "G-BBRQ4TY5SD"
};
firebase.initializeApp(firebaseConfig);
var db = firebase.firestore();

// Initialize Google Map
var map;
var marker;

function initMap() {
    // Initialize with a default location
    var initialLocation = { lat: -34.397, lng: 150.644 };

    map = new google.maps.Map(document.getElementById('map'), {
        center: initialLocation,
        zoom: 8
    });

    marker = new google.maps.Marker({
        position: initialLocation,
        map: map
    });

    // Listen for location updates
    listenToLocationUpdates();
}

function listenToLocationUpdates() {
    const userId = getQueryParam('userId');
    if (userId) {
        db.collection("users").doc(userId).onSnapshot(function(doc) {
            var location = doc.data().location;
            if (location) {
                var newPos = new google.maps.LatLng(location.latitude, location.longitude);
                marker.setPosition(newPos);
                map.setCenter(newPos);
            }
        });
    } else {
        console.log("User ID not provided in URL");
    }
}



// Listen for location changes
function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

// Use getQueryParam to extract the userId
const userId = getQueryParam('userId'); 
if (userId) {
    db.collection("users").doc(userId).onSnapshot(function(doc) {
        var location = doc.data().location;
        var newPos = new google.maps.LatLng(location.latitude, location.longitude);
        marker.setPosition(newPos);
        map.setCenter(newPos);
    });
} else {
    console.log("User ID not provided in URL");
}

// Initialize the map
initMap();
    </script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-firestore.js"></script>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDW4M6LkqAXwFkpyUMBv9RVASdwZCMy5P4&callback=initMap" async defer></script>
    <!-- <script src="script.js"></script> -->
</body>
</html>
